document.addEventListener('DOMContentLoaded', function() {
    getEx();
});

async function getEx() {
    try {
        const response = await fetch('/data/exploits.json');
        const data = await response.json();
        data.forEach(exploit => {
            const exploitElement = document.querySelector(`.${exploit.Name}`);
            if (exploitElement) {
                const titleElement = exploitElement.querySelector('.exploit-title');
                const descElement = exploitElement.querySelector('.exploit-desc');
                const authorElement = exploitElement.querySelector('.exploit-author');
                const versionElement = exploitElement.querySelector('.exploit-version');

                titleElement.textContent = exploit.Name;
                descElement.textContent = exploit.Name + ' ' + exploit.Category;

                if (Array.isArray(exploit.Author)) {
                    authorElement.textContent = exploit.Author.join(', ');
                } else {
                    authorElement.textContent = exploit.Author;
                }

                versionElement.textContent = exploit.Version.join(', ');
            }
        });
        filterExploits();
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

function filterExploits() {
    const versionSelect = document.getElementById('ver-select');
    const catSelect = document.getElementById('cat-select');
    const ownerSelect = document.getElementById('owner-select');

    const versionValue = versionSelect.value;
    const catValue = catSelect.value;
    const ownerValue = ownerSelect.value;

    const exploitButtons = document.querySelectorAll('.exploit-area > div');

    exploitButtons.forEach(button => {
        const versionElement = button.querySelector('.exploit-version');
        const catElement = button.querySelector('.exploit-desc');
        const authorElement = button.querySelector('.exploit-author');

        const versionText = versionElement.textContent;
        const catText = catElement.textContent;
        const authorText = authorElement.textContent;

        const showButton =
            (versionValue === 'Version' || exploit.Version.includes(versionValue)) &&
            (catValue === 'Category' || catText.includes(catValue)) &&
            (ownerValue === 'Owner' || authorText.includes(ownerValue));

        button.style.display = showButton ? 'block' : 'none';
    });
}

document.getElementById('ver-select').addEventListener('change', filterExploits);
document.getElementById('cat-select').addEventListener('change', filterExploits);
document.getElementById('owner-select').addEventListener('change', filterExploits);
